---
globs: services/geminiService.ts,App.tsx
description: Int√©gration et configuration de l'API Gemini pour le sparring-partner IA
---

# ü§ñ Int√©gration API Gemini - Subtilit√©s Techniques

## üîß **Configuration & S√©curit√©**
```javascript
// Variables d'environnement via Vite
if (!process.env.API_KEY) {
  throw new Error("API_KEY environment variable not set");
}
const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
```

## üé≠ **Architecture Multi-R√¥les IA**

### 1. **Classification Intelligente** (`getInitialResponse`)
L'IA analyse la demande utilisateur et d√©cide du mode appropri√© :
- `SIMULATION_SETUP` - Entra√Ænement/jeu de r√¥le
- `DEBRIEF` - Analyse conversation pass√©e  
- `JOURNAL` - √âcriture r√©flexive
- `MENTAL_PREP` - Pr√©paration stress imm√©diat

### 2. **Simulation Dual-Persona** (`getSimulationResponse`)
```javascript
// L'IA joue 2 r√¥les simultan√©ment :
// 1. Le prospect/client (persona)
// 2. Le coach expert (commentaires m√©ta)
{
  personaResponse: "R√©ponse du client simul√©",
  coachComment: "Conseil du coach ou null"
}
```

### 3. **Configuration JSON Stricte**
```javascript
responseMimeType: "application/json",
responseSchema: { 
  type: Type.OBJECT,
  properties: { /* Structure d√©finie */ }
}
```

## üìö **Syst√®me d'Instructions Contextuelles**

### Base Syst√®me
```javascript
const systemInstructionBase = `Vous √™tes Echo, un sparring-partner et coach IA pour les professionnels de la vente. Votre but est d'aider les utilisateurs √† s'entra√Æner, √† d√©briefer et √† renforcer leur mindset de vente. Vous vous basez sur les 7 principes du mindset de vente: ${salesMindsetPrinciples}`;
```

### 7 Principes du Mindset Int√©gr√©s
1. R√©silience face au rejet
2. Orientation client et valeur
3. Confiance en soi
4. Mentalit√© proactive
5. Apprentissage continu
6. Gestion √©nergie/bien-√™tre
7. Abondance et gratitude

## ‚ö° **Gestion d'Erreurs Robuste**
Chaque fonction a un fallback gracieux en cas d'erreur API, maintenant l'exp√©rience utilisateur fluide.

## üîÑ **Mod√®le Utilis√©**
`gemini-2.5-flash` - Optimis√© pour conversations interactives rapides et coaching en temps r√©el.